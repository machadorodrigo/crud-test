<!DOCTYPE html>
<html>

<head>
    <title>
        <%=title%>
    </title>
    <link rel="stylesheet" type="text/css" href="/../css/fluig-style-guide.min.css">
    <link rel="stylesheet" href="/../css/style.css">
    <script src="/../js/jquery.js"></script>
    <script src="/../js/jquery-ui.min.js"></script>
    <script src="/../js/mustache-min.js"></script>
    <script src="/../js/fluig-style-guide.min.js"></script>
</head>

<body>
    <div class="fluig-style-guide">
        <div class="row">

            <form method="post" action="" id="the-form">
                <table cellpadding="11">
                    <tr>
                        <td class="label">Nome</td>
                        <td>:
                            <input type="text" name="name">
                        </td>
                    </tr>
                    <tr>
                        <td class="label">Email</td>
                        <td>:
                            <input type="text" name="email">
                        </td>
                    </tr>
                    <tr>
                        <td class="label">Password</td>
                        <td>:
                            <input type="password" name="password">
                        </td>
                    </tr>
                    <tr>
                        <td class="label"></td>
                        <td>
                            &nbsp;
                            <input type="button" value="Save" onClick="saveUser()">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <div class="page-data">
            <ul class="err-area"></ul>
        </div>
		
		<div>
			<div class="panel panel-default">
				<div class="panel-body">
					<table class="table table-striped">
						<thead>
							<tr>
								<th width="50px">Id</th>
								<th>Nome</th>
								<th>E-mail</th>
								<th>Senha</th>
								<th>Ação</th>
							</tr>
						</thead>
						<tbody>
							<% if(data.length){ 
									
					 for(var i = 0;i < data.length;i++) { %>

								<tr>
									<td>
										<%=(i+1)%>
									</td>
									<td>
										<%=data[i].name%>
									</td>
									<td>
										<%=data[i].email%>
									</td>
									<td>
										<%=data[i].password%>
									</td>
									<td>
										<a class="a-inside edit" href="/api/user/<%=data[i].user_id%>"><span class="fluigicon fluigicon-pencil fluigicon-sm"></span></a>
										<a class="a-inside delete" href="javascript:void(0)" onClick="deleteUser(<%=data[i].user_id%>)"><span class="fluigicon fluigicon-remove fluigicon-sm"></span></a>
									</td>
								</tr>
								<% }
					
					 }else{ %>
									<tr>
										<td colspan="5">Nenhum registro</td>
									</tr>
									<% } %>
						</tbody>
					</table>
				</div>
			</div>
        </div>
    </div>
    <script>
        function saveUser() {

            $.ajax({

                url: "/api/user",
                type: "post",
                data: $("#the-form").serialize(),
                success: function(res) {

                    window.location.reload();
                    return false;
                },
                error: function(xhr, status, error) {

                    console.log(xhr.responseText);
                    var err = '';
                    $.each(JSON.parse(xhr.responseText), function(i, item) {

                        err += '<li>' + item.msg + '</li>';
                    });
                    $(".err-area").html(err);
                    return false;
                }

            });
        }

        function deleteUser(user_id) {

            $.ajax({
                url: "/api/user/" + user_id,
                type: 'DELETE',
                success: function(res) {

                    window.location.reload();
                    return false;
                },
                error: function(xhr, status, error) {

                    console.log(xhr.responseText);
                    alert("Error deleting");
                    return false;
                }
            });
        }
    </script>
</body>

</html>